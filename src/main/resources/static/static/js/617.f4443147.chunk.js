"use strict";(self.webpackChunksalary_management_frontend=self.webpackChunksalary_management_frontend||[]).push([[617],{8617:(e,a,l)=>{l.r(a),l.d(a,{default:()=>i});var n=l(9379),r=l(5043),s=l(9722),o=l(3216),t=l(579);const i=function(){var e,a,l,i,c,d,u,m,p,h,v,y,b,x,g,j,f,w,A,D,S,C,N,F,E;const{id:I}=(0,o.g)(),[P,T]=(0,r.useState)({id:null,name:"",designation:"",department:"",role:"",salaryDate:"",employeeId:"",days:null,basicSalary:null,hra:null,dearnessAllowance:null,conveyanceAllowance:null,specialAllowance:null,leads:null,performanceIncentive:null,perCall:null,areaAllowance:null,os:null,roadshow:null,review:null,dresscode:null,attendanceAllowance:null,arrears:null,bonus:null,professionalTax:null,incomeTax:null,providentFund:null,advance:null,loanDeduction:null,salesDebits:null,underPerformance:null,otherAllowance:null,otherDeduction:null,grossSalary:null,totalDeduction:null,netSalary:null}),O=e=>null==e?0:e,[k,R]=(0,r.useState)(null),[B,L]=(0,r.useState)([]),[M,Y]=(0,r.useState)({});(0,r.useEffect)(()=>{try{const e=localStorage.getItem("customBoxes");if(e){const a=JSON.parse(e),l=Array.isArray(a)?a.map(e=>({id:e.id,label:e.label,category:e.category||"Earnings"})):[];L(l)}}catch(e){}},[]);const U=(0,r.useCallback)(function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B;const r=O(e.days),s=(O(e.basicSalary)+O(e.hra)+O(e.dearnessAllowance)+O(e.specialAllowance))*(r/30),o=O(e.conveyanceAllowance)+O(e.performanceIncentive)+O(e.perCall)+O(e.attendanceAllowance),t=(l||[]).filter(e=>"Earnings"===e.category).reduce((e,l)=>e+O(a[l.label]),0),i=O(e.leads)+O(e.areaAllowance)+O(e.os)+O(e.roadshow)+O(e.review)+O(e.dresscode)+O(e.arrears)+O(e.bonus)+t,c=s+o+i,d=(l||[]).filter(e=>"Deductions"===e.category).reduce((e,l)=>e+O(a[l.label]),0),u=O(e.advance)+O(e.salesDebits)+O(e.underPerformance)+d,m=O(e.professionalTax)+O(e.incomeTax)+O(e.providentFund)+O(e.loanDeduction)+u,p=c-m;return(0,n.A)((0,n.A)({},e),{},{otherAllowance:i,otherDeduction:u,grossSalary:c,totalDeduction:m,netSalary:p})},[]),J=(e,a)=>{const l=B.find(a=>a.label===e);let r=a;l&&("Earnings"===l.category||"Deductions"===l.category)&&(r=""===a?0:parseFloat(a));const s=(0,n.A)((0,n.A)({},M),{},{[e]:r});Y(s),T(e=>U(e,s,B))};(0,r.useEffect)(()=>{(async()=>{try{const e=(await s.A.get("/api/employees/".concat(I))).data;let a={},r=[];try{const e=localStorage.getItem("customBoxes");if(e){const a=JSON.parse(e);r=Array.isArray(a)?a.map(e=>({id:e.id,label:e.label,category:e.category||"Earnings"})):[]}}catch(l){}if(e.customFields)try{const l=JSON.parse(e.customFields);if(Array.isArray(l)){l.forEach(e=>{a[e.label]=e.value});const e=new Set(r.map(e=>e.label)),n=l.filter(a=>!e.has(a.label)).map(e=>({id:Date.now()+Math.random(),label:e.label,category:e.category}));r=[...r,...n]}}catch(n){}L(r),Y(a),T(U(e,a,r))}catch(r){var e,a;R((null===r||void 0===r||null===(e=r.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||r.message)}})()},[I,U]);const _=e=>{const{name:a,value:l,type:r}=e.target,s="number"===r?""===l?null:parseFloat(l):l;T(e=>U((0,n.A)((0,n.A)({},e),{},{[a]:s}),M,B))},[H,q]=(0,r.useState)(!1),z=(0,o.Zp)(),V=localStorage.getItem("role")||"";return(0,t.jsxs)("div",{className:"form-container edit-screen",children:[(0,t.jsx)("style",{children:'\n                .edit-screen input[type="text"],\n                .edit-screen input[type="number"],\n                .edit-screen input[type="date"] {\n                    height: 48px;\n                    min-height: 48px;\n                    padding: 10px 12px;\n                    line-height: 28px;\n                }\n            '}),(0,t.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),q(!0),null==P.days||P.days<=0)return R("Days is required and must be greater than 0"),void q(!1);try{if(!P.employeeId||""===String(P.employeeId).trim())throw new Error("Please select employee from list");const e=new Date(P.salaryDate||new Date),a=e.getFullYear(),l=e.getMonth()+1,n=await s.A.get("/api/employees?year=".concat(a,"&month=").concat(l));if((n.data||[]).some(e=>String(e.employeeId||"").trim()===String(P.employeeId).trim()&&e.id!==P.id))throw new Error("Salary already exists for this employee in this month")}catch(i){return R(i.message),void q(!1)}const a=B.map(e=>({label:e.label,category:e.category,value:M[e.label]})).filter(e=>void 0!==e.value&&null!==e.value&&""!==e.value&&0!==e.value),l=a.filter(e=>"Earnings"===e.category).reduce((e,a)=>e+(parseFloat(a.value)||0),0),n=a.filter(e=>"Deductions"===e.category).reduce((e,a)=>e+(parseFloat(a.value)||0),0),r={id:P.id,name:P.name,designation:P.designation,department:P.department,role:P.role,salaryDate:P.salaryDate,employeeId:P.employeeId,days:P.days,basicSalary:P.basicSalary,hra:P.hra,dearnessAllowance:P.dearnessAllowance,conveyanceAllowance:P.conveyanceAllowance,specialAllowance:P.specialAllowance,leads:P.leads,performanceIncentive:P.performanceIncentive,perCall:P.perCall,areaAllowance:P.areaAllowance,os:P.os,roadshow:P.roadshow,review:P.review,dresscode:P.dresscode,attendanceAllowance:P.attendanceAllowance,arrears:P.arrears,bonus:P.bonus,professionalTax:P.professionalTax,incomeTax:P.incomeTax,providentFund:P.providentFund,advance:P.advance,loanDeduction:P.loanDeduction,salesDebits:P.salesDebits,underPerformance:P.underPerformance,otherAllowance:P.otherAllowance,otherDeduction:P.otherDeduction,grossSalary:P.grossSalary,totalDeduction:P.totalDeduction,netSalary:P.netSalary,customFields:JSON.stringify(a),customAllowanceAmount:l,customDeductionAmount:n};try{await s.A.put("/api/employees/".concat(P.id),r,{headers:{"Content-Type":"application/json",Accept:"application/json"}}),z("/employees")}catch(c){var o,t;R((null===c||void 0===c||null===(o=c.response)||void 0===o||null===(t=o.data)||void 0===t?void 0:t.message)||c.message)}finally{q(!1)}},children:[(0,t.jsxs)("div",{className:"form-grid",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"employee-name",children:"Employee Name"}),(0,t.jsx)("input",{id:"employee-name",name:"name",type:"text",placeholder:"Employee Name",value:null!==(e=P.name)&&void 0!==e?e:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"designation",children:"Designation"}),(0,t.jsx)("input",{id:"designation",name:"designation",type:"text",placeholder:"Designation",value:null!==(a=P.designation)&&void 0!==a?a:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"days",children:"Days"}),(0,t.jsx)("input",{id:"days",name:"days",type:"number",placeholder:"Days",value:null!==(l=P.days)&&void 0!==l?l:"",onChange:e=>T((0,n.A)((0,n.A)({},P),{},{days:Number(e.target.value||0)})),required:!0})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"basicSalary",children:"Basic salary"}),(0,t.jsx)("input",{id:"basicSalary",name:"basicSalary",type:"number",placeholder:"Basic salary",value:null!==(i=P.basicSalary)&&void 0!==i?i:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"hra",children:"House Rent Allowance"}),(0,t.jsx)("input",{id:"hra",name:"hra",type:"number",placeholder:"House Rent Allowance",value:null!==(c=P.hra)&&void 0!==c?c:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"dearnessAllowance",children:"Dearness Allowance"}),(0,t.jsx)("input",{id:"dearnessAllowance",name:"dearnessAllowance",type:"number",placeholder:"Dearness Allowance",value:null!==(d=P.dearnessAllowance)&&void 0!==d?d:"",onChange:_})]}),B.filter(e=>"Employee"===e.category).map(e=>{var a;return(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{children:e.label}),(0,t.jsx)("input",{type:"text",value:null!==(a=M[e.label])&&void 0!==a?a:"",onChange:a=>J(e.label,a.target.value)})]},e.id)}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{children:"Basic + HRA + DA (auto)"}),(0,t.jsx)("input",{type:"number",readOnly:!0,"aria-readonly":"true",value:(O(P.basicSalary)+O(P.hra)+O(P.dearnessAllowance)).toFixed(2)})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"conveyanceAllowance",children:"Conveyance allowance"}),(0,t.jsx)("input",{id:"conveyanceAllowance",name:"conveyanceAllowance",type:"number",placeholder:"Conveyance allowance",value:null!==(u=P.conveyanceAllowance)&&void 0!==u?u:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"specialAllowance",children:"Special allowance"}),(0,t.jsx)("input",{id:"specialAllowance",name:"specialAllowance",type:"number",placeholder:"Special allowance",value:null!==(m=P.specialAllowance)&&void 0!==m?m:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"leads",children:"Leads"}),(0,t.jsx)("input",{id:"leads",name:"leads",type:"number",placeholder:"Leads",value:null!==(p=P.leads)&&void 0!==p?p:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"performanceIncentive",children:"Sales incentive"}),(0,t.jsx)("input",{id:"performanceIncentive",name:"performanceIncentive",type:"number",placeholder:"Sales incentive",value:null!==(h=P.performanceIncentive)&&void 0!==h?h:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"perCall",children:"Per-call inc"}),(0,t.jsx)("input",{id:"perCall",name:"perCall",type:"number",placeholder:"Per-call inc",value:null!==(v=P.perCall)&&void 0!==v?v:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"areaAllowance",children:"Area allowance"}),(0,t.jsx)("input",{id:"areaAllowance",name:"areaAllowance",type:"number",placeholder:"Area allowance",value:null!==(y=P.areaAllowance)&&void 0!==y?y:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"os",children:"OS"}),(0,t.jsx)("input",{id:"os",name:"os",type:"number",placeholder:"OS",value:null!==(b=P.os)&&void 0!==b?b:"",onChange:_})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"roadshow",children:"Roadshow promo"}),(0,t.jsx)("input",{id:"roadshow",name:"roadshow",type:"number",placeholder:"Roadshow promo",value:null!==(x=P.roadshow)&&void 0!==x?x:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"review",children:"Review"}),(0,t.jsx)("input",{id:"review",name:"review",type:"number",placeholder:"Review",value:null!==(g=P.review)&&void 0!==g?g:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"dresscode",children:"Dresscode"}),(0,t.jsx)("input",{id:"dresscode",name:"dresscode",type:"number",placeholder:"Dresscode",value:null!==(j=P.dresscode)&&void 0!==j?j:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"attendanceAllowance",children:"Attendance allowance"}),(0,t.jsx)("input",{id:"attendanceAllowance",name:"attendanceAllowance",type:"number",placeholder:"Attendance allowance",value:null!==(f=P.attendanceAllowance)&&void 0!==f?f:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"arrears",children:"Arrears"}),(0,t.jsx)("input",{id:"arrears",name:"arrears",type:"number",placeholder:"Arrears",value:null!==(w=P.arrears)&&void 0!==w?w:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"bonus",children:"Bonus"}),(0,t.jsx)("input",{id:"bonus",name:"bonus",type:"number",placeholder:"Bonus",value:null!==(A=P.bonus)&&void 0!==A?A:"",onChange:_})]}),B.filter(e=>"Earnings"===e.category).map(e=>{var a;return(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsxs)("label",{children:[e.label," ",(0,t.jsx)("button",{type:"button",style:{fontSize:"0.7em",color:"red",border:"none",background:"none"},onClick:()=>{L(a=>a.filter(a=>a.id!==e.id));const a=(0,n.A)({},M);delete a[e.label],Y(a),T(l=>U(l,a,B.filter(a=>a.id!==e.id)))},children:"(x)"})]}),(0,t.jsx)("input",{type:"number",value:null!==(a=M[e.label])&&void 0!==a?a:"",onChange:a=>J(e.label,a.target.value)})]},e.id)}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"grossSalary",children:"Grosspay (auto)"}),(0,t.jsx)("input",{id:"grossSalary",type:"number",readOnly:!0,"aria-readonly":"true",value:O(P.grossSalary).toFixed(2)})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"professionalTax",children:"Ess/16"}),(0,t.jsx)("input",{id:"professionalTax",name:"professionalTax",type:"number",placeholder:"Ess/16",value:null!==(D=P.professionalTax)&&void 0!==D?D:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"advance",children:"Advance/17"}),(0,t.jsx)("input",{id:"advance",name:"advance",type:"number",placeholder:"Advance/17",value:null!==(S=P.advance)&&void 0!==S?S:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"loanDeduction",children:"Loan/18"}),(0,t.jsx)("input",{id:"loanDeduction",name:"loanDeduction",type:"number",placeholder:"Loan/18",value:null!==(C=P.loanDeduction)&&void 0!==C?C:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"salesDebits",children:"Sales debits/19"}),(0,t.jsx)("input",{id:"salesDebits",name:"salesDebits",type:"number",placeholder:"Sales debits/19",value:null!==(N=P.salesDebits)&&void 0!==N?N:"",onChange:_})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"underPerformance",children:"Underperformance/20"}),(0,t.jsx)("input",{id:"underPerformance",name:"underPerformance",type:"number",placeholder:"Underperformance/20",value:null!==(F=P.underPerformance)&&void 0!==F?F:"",onChange:_})]}),B.filter(e=>"Deductions"===e.category).map(e=>{var a;return(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsxs)("label",{children:[e.label," ",(0,t.jsx)("button",{type:"button",style:{fontSize:"0.7em",color:"red",border:"none",background:"none"},onClick:()=>{L(a=>a.filter(a=>a.id!==e.id));const a=(0,n.A)({},M);delete a[e.label],Y(a),T(l=>U(l,a,B.filter(a=>a.id!==e.id)))},children:"(x)"})]}),(0,t.jsx)("input",{type:"number",value:null!==(a=M[e.label])&&void 0!==a?a:"",onChange:a=>J(e.label,a.target.value)})]},e.id)}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"totalDeduction",children:"Total Deduction (auto)"}),(0,t.jsx)("input",{id:"totalDeduction",type:"number",readOnly:!0,"aria-readonly":"true",value:O(P.totalDeduction).toFixed(2)})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"netSalary",children:"Net (auto)"}),(0,t.jsx)("input",{id:"netSalary",type:"number",readOnly:!0,"aria-readonly":"true",value:O(P.netSalary).toFixed(2)})]}),(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{htmlFor:"salaryDate",children:"Salary Date"}),(0,t.jsx)("input",{id:"salaryDate",name:"salaryDate",type:"date",placeholder:"YYYY-MM-DD",value:null!==(E=P.salaryDate)&&void 0!==E?E:"",onChange:_})]}),B.filter(e=>"Summary"===e.category).map(e=>{var a;return(0,t.jsxs)("div",{className:"form-item",children:[(0,t.jsx)("label",{children:e.label}),(0,t.jsx)("input",{type:"text",value:null!==(a=M[e.label])&&void 0!==a?a:"",onChange:a=>J(e.label,a.target.value)})]},e.id)})]})]}),(0,t.jsxs)("div",{className:"btn-container",children:[!("EMPLOYEE"===V&&"APPROVED"===String(P.status||"").toUpperCase())&&(0,t.jsx)("button",{type:"submit",disabled:H,children:"Save Changes"}),(0,t.jsx)("button",{type:"button",onClick:()=>z("/employees"),children:"Cancel"}),"EMPLOYEE"===V&&"APPROVED"!==String(P.status||"DRAFT").toUpperCase()&&(0,t.jsx)("button",{type:"button",className:"btn btn-outline-primary",onClick:async()=>{try{await s.A.post("/api/employees/".concat(P.id,"/submit"));const e=await s.A.get("/api/employees/".concat(P.id));T(U(e.data))}catch(l){var e,a;R((null===l||void 0===l||null===(e=l.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||l.message)}},style:{marginLeft:8},children:"Submit for Approval"}),"ADMIN"===V&&"SUBMITTED"===String(P.status||"").toUpperCase()&&(0,t.jsx)("button",{type:"button",className:"btn btn-success",onClick:async()=>{try{await s.A.post("/api/employees/".concat(P.id,"/approve"));const e=await s.A.get("/api/employees/".concat(P.id));T(U(e.data))}catch(l){var e,a;R((null===l||void 0===l||null===(e=l.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||l.message)}},style:{marginLeft:8},children:"Approve"})]})]})]})}}}]);
//# sourceMappingURL=617.f4443147.chunk.js.map