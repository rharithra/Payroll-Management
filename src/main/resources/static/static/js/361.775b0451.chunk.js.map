{"version":3,"file":"static/js/361.775b0451.chunk.js","mappings":"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","sources":["components/Payslip.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\nimport { useSearchParams, Link } from 'react-router-dom';\r\n\r\nfunction Payslip() {\r\n  const [employees, setEmployees] = useState([]);\r\n  const [selectedId, setSelectedId] = useState('');\r\n  const [slip, setSlip] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [params] = useSearchParams();\r\n  const [masters, setMasters] = useState([]);\r\n  useEffect(() => {\r\n    axios.get('/api/employee-masters')\r\n      .then(res => setMasters(res.data || []))\r\n      .catch(() => setMasters([]));\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const fetchEmployees = async () => {\r\n      try {\r\n        const res = await axios.get('/api/employees');\r\n        setEmployees(res.data || []);\r\n      } catch (err) {\r\n        setError('Failed to load employees');\r\n        console.error(err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchEmployees();\r\n  }, []);\r\n\r\n  // NEW: Month/Employee selectors and filtered pay slip options\r\n  const [selectedMonth, setSelectedMonth] = useState('');      // YYYY-MM\r\n  const [selectedMasterEmpId, setSelectedMasterEmpId] = useState(''); // employeeId from master\r\n  const [filteredSlips, setFilteredSlips] = useState([]);\r\n\r\n  const monthKey = (d) => {\r\n    if (!d) return '';\r\n    try {\r\n      const dt = new Date(d);\r\n      if (isNaN(dt.getTime())) {\r\n        // if already yyyy-mm-dd string, take yyyy-mm\r\n        const s = String(d);\r\n        return s.length >= 7 ? s.substring(0, 7) : '';\r\n      }\r\n      const y = dt.getFullYear();\r\n      const m = String(dt.getMonth() + 1).padStart(2, '0');\r\n      return `${y}-${m}`;\r\n    } catch {\r\n      return '';\r\n    }\r\n  };\r\n\r\n  // Initialize month from query like ?month=YYYY-MM\r\n  useEffect(() => {\r\n    const m = params.get('month');\r\n    if (m && /^\\d{4}-\\d{2}$/.test(m)) setSelectedMonth(m);\r\n  }, [params]);\r\n\r\n  // Recompute filtered pay slips when month or employee changes\r\n  useEffect(() => {\r\n    // Gate display until both month and employee are chosen\r\n    const hasMonth = !!(selectedMonth && selectedMonth.trim());\r\n    const hasEmp = !!(selectedMasterEmpId && String(selectedMasterEmpId).trim());\r\n\r\n    if (!hasMonth || !hasEmp) {\r\n        setFilteredSlips([]);\r\n        setSelectedId('');\r\n        return;\r\n    }\r\n\r\n    const master = masters.find(m => String(m.employeeId).trim().toLowerCase() === String(selectedMasterEmpId).trim().toLowerCase());\r\n    const empId = master?.employeeId?.toString().trim().toLowerCase();\r\n    const month = selectedMonth?.toString().trim();\r\n\r\n    let list = employees;\r\n    if (empId) {\r\n        list = list.filter(e => {\r\n            const eid = (e.employeeId ?? '').toString().trim().toLowerCase();\r\n            const nameMatch = (!e.employeeId && master?.name && e?.name && master.name.trim() === e.name.trim());\r\n            return eid === empId || nameMatch;\r\n        });\r\n    }\r\n    if (month) {\r\n        list = list.filter(e => monthKey(e.salaryDate) === month);\r\n    }\r\n\r\n    list = list.slice().sort((a, b) => {\r\n        const ad = new Date(a.salaryDate || 0).getTime();\r\n        const bd = new Date(b.salaryDate || 0).getTime();\r\n        return bd - ad;\r\n    });\r\n\r\n    setFilteredSlips(list);\r\n    setSelectedId(list.length ? String(list[0].id) : '');\r\n  }, [selectedMonth, selectedMasterEmpId, employees, masters]);\r\n\r\n  useEffect(() => {\r\n    const emp = employees.find(e => String(e.id) === String(selectedId));\r\n    setSlip(emp || null);\r\n  }, [selectedId, employees]);\r\n\r\n  const formatDate = (s) => {\r\n    if (!s) return '';\r\n    const d = new Date(s);\r\n    if (isNaN(d.getTime())) return s;\r\n    return `${String(d.getDate()).padStart(2, '0')}-${String(d.getMonth() + 1).padStart(2, '0')}-${d.getFullYear()}`;\r\n  };\r\n\r\n  // Add Month & Year formatter (e.g., Oct-25)\r\n  const formatMonthYear = (s) => {\r\n    if (!s) return '';\r\n    const d = new Date(s);\r\n    if (isNaN(d.getTime())) return s;\r\n    const mon = d.toLocaleString('default', { month: 'short' });\r\n    const yr = String(d.getFullYear()).slice(2);\r\n    return `${mon}-${yr}`;\r\n  };\r\n\r\n  const handlePrint = () => window.print();\r\n\r\n  // add formatter for currency-like numbers\r\n  const fmt = (v) => {\r\n    const n = Number(v ?? 0);\r\n    return n.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });\r\n  };\r\n  const roundInt = (v) => Math.round(Number(v ?? 0));\r\n\r\n  const handleDownloadPdf = async () => {\r\n    const el = document.getElementById('print-area');\r\n    if (!el) return;\r\n    \r\n    const html2canvas = (await import('html2canvas')).default;\r\n    const jsPDF = (await import('jspdf')).default;\r\n    \r\n    const canvas = await html2canvas(el, { scale: 2, useCORS: true });\r\n    const imgData = canvas.toDataURL('image/png');\r\n\r\n    const pdf = new jsPDF('p', 'mm', 'a4');\r\n      const pdfWidth = pdf.internal.pageSize.getWidth();\r\n      const pdfHeight = (canvas.height * pdfWidth) / canvas.width;\r\n  \r\n      pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);\r\n      pdf.save(`Payslip_${selectedId || 'employee'}.pdf`);\r\n  };\r\n\r\n  if (loading) return <div className=\"text-center mt-4\">Loading...</div>;\r\n  if (error) return <div className=\"alert alert-danger mt-3\">{error}</div>;\r\n  const hasSelections = !!(\r\n    selectedMonth && selectedMonth.trim() &&\r\n    selectedMasterEmpId && String(selectedMasterEmpId).trim()\r\n  );\r\n\r\n  return (\r\n    <div className=\"payslip-page\">\r\n      {/* Header + actions */}\r\n      <div className=\"payslip-header no-print\">\r\n        <h2>Salary Slip</h2>\r\n        <div className=\"payslip-actions\">\r\n          <Link to=\"/employees\" className=\"btn btn-secondary btn-rounded\">Back to List</Link>\r\n          <button type=\"button\" className=\"btn btn-primary btn-rounded\" onClick={handlePrint}>Print</button>\r\n          <button\r\n              className=\"btn btn-outline-secondary no-print\"\r\n              onClick={handleDownloadPdf}\r\n          >\r\n              Download PDF\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* NEW: Month + Employee + Pay Slip selectors */}\r\n      <div className=\"payslip-selector no-print\" style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 12, alignItems: 'end' }}>\r\n        <div>\r\n          <label htmlFor=\"monthSelect\">Select Month</label>\r\n          <input\r\n            id=\"monthSelect\"\r\n            type=\"month\"\r\n            value={selectedMonth}\r\n            onChange={(e) => setSelectedMonth(e.target.value)}\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <label htmlFor=\"employeeMasterSelect\">Select Employee</label>\r\n          <select\r\n            id=\"employeeMasterSelect\"\r\n            value={selectedMasterEmpId}\r\n            onChange={(e) => setSelectedMasterEmpId(e.target.value)}\r\n          >\r\n            <option value=\"\">-- Select --</option>\r\n            {masters.map(m => {\r\n              const label = [m.name, m.employeeId].filter(Boolean).join(' - ');\r\n              return (\r\n                <option key={m.employeeId || m.id || label} value={m.employeeId || ''}>\r\n                  {label}\r\n                </option>\r\n              );\r\n            })}\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Payslip content */}\r\n      {slip ? (\r\n        <div className=\"payslip-container\" id=\"print-area\">\r\n          <div className=\"payslip-card\">\r\n            <div className=\"classic-header\">\r\n              <img\r\n                className=\"brand-logo\"\r\n                src={process.env.PUBLIC_URL + '/Logo.PNG'}\r\n                alt=\"Company logo\"\r\n                onError={(e) => {\r\n                    // Fallback: try lowercase, then hide if missing\r\n                    if (e.target.dataset.triedLower !== '1') {\r\n                        e.target.dataset.triedLower = '1';\r\n                        e.target.src = process.env.PUBLIC_URL + '/logo.png';\r\n                    } else {\r\n                        e.target.style.display = 'none';\r\n                    }\r\n                }}\r\n              />\r\n              <div className=\"company-block\">\r\n                <div className=\"company-title\">Anjo Aqua World</div>\r\n                <div>219/40 Kamaraj Road, Kumbakonam-612001</div>\r\n                <div>Phone: 81 44 22 77 22</div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"classic-title\">Pay Slip</div>\r\n\r\n            {/* Employee details grid/table */}\r\n            <table className=\"payslip-classic\">\r\n              <tbody>\r\n                <tr>\r\n                  <th>Employee Name</th><td>{slip.name ?? ''}</td>\r\n                  <th>Employee ID.</th>\r\n                  <td>{\r\n                    slip.employeeId\r\n                      ?? (masters.find(m => m.name === slip.name)?.employeeId ?? '')  // NEW: fallback to master\r\n                  }</td>\r\n                </tr>\r\n                <tr>\r\n                  <th>Designation</th><td>{slip.designation ?? ''}</td>\r\n                  <th>Month & Year</th><td>{formatMonthYear(slip.salaryDate) || 'â€”'}</td>\r\n                </tr>\r\n                <tr>\r\n                  <th>Days Working</th><td>{slip.days ?? ''}</td>\r\n                  <th></th><td></td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n            {(() => {\r\n              const basicHra = (slip.basicSalary ?? 0) + (slip.hra ?? 0);\r\n              return (\r\n                <table className=\"payslip-classic two-col\">\r\n                  <thead>\r\n                    <tr>\r\n                      <th>Earnings</th><th className=\"right\">Amount</th>\r\n                      <th>Deductions</th><th className=\"right\">Amount</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    <tr><td>Basic+HRA</td><td className=\"right\">{fmt(basicHra)}</td><td>ESS</td><td className=\"right\">{roundInt(slip.professionalTax)}</td></tr>\r\n                    <tr><td>Conveyance</td><td className=\"right\">{fmt(slip.conveyanceAllowance)}</td><td>Advance</td><td className=\"right\">{fmt(slip.advance)}</td></tr>\r\n                    <tr><td>Sales Incentive</td><td className=\"right\">{fmt(slip.performanceIncentive)}</td><td>Loan</td><td className=\"right\">{fmt(slip.loanDeduction)}</td></tr>\r\n                    <tr><td>Per Call Incentive</td><td className=\"right\">{fmt(slip.perCall)}</td><td>Sales Debits</td><td className=\"right\">{fmt(slip.salesDebits)}</td></tr>\r\n                    <tr><td>Attendance Incentive</td><td className=\"right\">{fmt(slip.attendanceAllowance)}</td><td>Underperformance</td><td className=\"right\">{fmt(slip.underPerformance)}</td></tr>\r\n                    <tr><td>Spl Allowance</td><td className=\"right\">{fmt(slip.specialAllowance)}</td><td>Others</td><td className=\"right\">{fmt(slip.otherDeduction)}</td></tr>\r\n                    <tr><td>Other Allowance</td><td className=\"right\">{fmt(slip.otherAllowance)}</td><td></td><td></td></tr>\r\n                    <tr className=\"bold\">\r\n                      <td>Gross Salary</td><td className=\"right\">{fmt(slip.grossSalary)}</td>\r\n                      <td>Total Deductions</td><td className=\"right\">{roundInt(slip.totalDeduction)}</td>\r\n                    </tr>\r\n                    <tr className=\"bold\">\r\n                      <td colSpan=\"2\"></td>\r\n                      <td>Net salary</td><td className=\"right\">{roundInt(slip.netSalary)}</td>\r\n                    </tr>\r\n                  </tbody>\r\n                </table>\r\n              );\r\n            })()}\r\n            {/* Spacer to move signatures down for writing space */}\r\n            <div style={{ height: '48px' }}></div>\r\n            <div className=\"signature-row\">\r\n              <div>Employee Signature</div>\r\n              <div>Manager</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        hasSelections ? (\r\n          <div className=\"alert alert-warning\">No data available for selected period</div>\r\n        ) : (\r\n          <div className=\"payslip-hint\">Please select month and employee to view payslip.</div>\r\n        )\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Payslip;"],"names":["_slip$name","_slip$employeeId","_masters$find$employe","_masters$find","_slip$designation","_slip$days","employees","setEmployees","useState","selectedId","setSelectedId","slip","setSlip","loading","setLoading","error","setError","params","useSearchParams","masters","setMasters","useEffect","axios","get","then","res","data","catch","async","err","console","fetchEmployees","selectedMonth","setSelectedMonth","selectedMasterEmpId","setSelectedMasterEmpId","filteredSlips","setFilteredSlips","m","test","_master$employeeId","hasMonth","trim","hasEmp","String","master","find","employeeId","toLowerCase","empId","toString","month","list","filter","e","_e$employeeId","eid","nameMatch","name","d","dt","Date","isNaN","getTime","s","length","substring","y","getFullYear","getMonth","padStart","concat","_unused","monthKey","salaryDate","slice","sort","a","b","ad","id","emp","fmt","v","Number","toLocaleString","minimumFractionDigits","maximumFractionDigits","roundInt","Math","round","_jsx","className","children","hasSelections","_jsxs","Link","to","type","onClick","handlePrint","window","print","el","document","getElementById","html2canvas","default","jsPDF","canvas","scale","useCORS","imgData","toDataURL","pdf","pdfWidth","internal","pageSize","getWidth","pdfHeight","height","width","addImage","save","style","display","gridTemplateColumns","gap","alignItems","htmlFor","value","onChange","target","map","label","Boolean","join","src","alt","onError","dataset","triedLower","designation","mon","yr","formatMonthYear","days","_slip$basicSalary","_slip$hra","basicHra","basicSalary","hra","professionalTax","conveyanceAllowance","advance","performanceIncentive","loanDeduction","perCall","salesDebits","attendanceAllowance","underPerformance","specialAllowance","otherDeduction","otherAllowance","grossSalary","totalDeduction","colSpan","netSalary"],"sourceRoot":""}